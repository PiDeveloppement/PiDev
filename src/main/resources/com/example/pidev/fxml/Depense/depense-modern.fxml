<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.PieChart?>

<BorderPane prefHeight="900" prefWidth="1600"
            style="-fx-background-color: #f1f5f9;"
            stylesheets="@../../css/design-system.css"
            xmlns="http://javafx.com/javafx/17.0.2-ea"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.example.pidev.controller.depense.DepenseListController">

    <center>
        <ScrollPane fitToHeight="true" fitToWidth="true"
                    hbarPolicy="NEVER" vbarPolicy="AS_NEEDED"
                    style="-fx-background-color: transparent; -fx-border-color: transparent;">
            <VBox spacing="0">

                <!-- HEADER -->
                <HBox alignment="CENTER_LEFT" spacing="20"
                      style="-fx-background-color: white; -fx-padding: 28 35;
                             -fx-border-color: #e2e8f0; -fx-border-width: 0 0 2 0;
                             -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.06), 8, 0, 0, 2);">

                    <VBox spacing="4">
                        <Label styleClass="label-title" text="ðŸ’³ Gestion des DÃ©penses" />
                        <Label styleClass="label-description" text="Suivi dÃ©taillÃ© de toutes les dÃ©penses par budget" />
                    </VBox>

                    <Region HBox.hgrow="ALWAYS" />

                    <VBox alignment="CENTER_RIGHT" spacing="2">
                        <Label style="-fx-text-fill: #94a3b8; -fx-font-size: 11px;" text="ðŸ“Š Vue d'ensemble" />
                        <Label style="-fx-text-fill: #1e293b; -fx-font-size: 13px; -fx-font-weight: bold;" text="17 FÃ©v 2026" />
                    </VBox>
                </HBox>

                <!-- KPI (5 cartes) -->
                <HBox spacing="10"
                      style="-fx-padding: 24 35; -fx-background-color: #f1f5f9;
                             -fx-border-color: #e2e8f0; -fx-border-width: 0 0 1 0;">

                    <VBox styleClass="stat-card stat-card-rose" HBox.hgrow="ALWAYS" maxWidth="300">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label style="-fx-font-size: 32px;" text="ðŸ’¸" />
                            <VBox spacing="3" HBox.hgrow="ALWAYS">
                                <Label styleClass="label-section" text="Total DÃ©penses" />
                                <Label fx:id="totalDepensesLabel" style="-fx-text-fill: #be123c;" styleClass="label-value" text="0 DT" />
                            </VBox>
                        </HBox>
                        <Label style="-fx-text-fill: #e11d48; -fx-font-size: 12px; -fx-font-weight: bold;" text="EngagÃ©es" />
                    </VBox>

                    <VBox styleClass="stat-card stat-card-blue" HBox.hgrow="ALWAYS" maxWidth="300">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label style="-fx-font-size: 32px;" text="ðŸ“‹" />
                            <VBox spacing="3" HBox.hgrow="ALWAYS">
                                <Label styleClass="label-section" text="Nombre total" />
                                <Label fx:id="countDepensesLabel" style="-fx-text-fill: #1e40af;" styleClass="label-value" text="0" />
                            </VBox>
                        </HBox>
                        <Label style="-fx-text-fill: #2563eb; -fx-font-size: 12px; -fx-font-weight: bold;" text="EnregistrÃ©es" />
                    </VBox>

                    <VBox styleClass="stat-card stat-card-emerald" HBox.hgrow="ALWAYS" maxWidth="300">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label style="-fx-font-size: 32px;" text="ðŸ“Š" />
                            <VBox spacing="3" HBox.hgrow="ALWAYS">
                                <Label styleClass="label-section" text="Ligne moyenne" />
                                <Label fx:id="avgDepenseLabel" style="-fx-text-fill: #15803d;" styleClass="label-value" text="0 DT" />
                            </VBox>
                        </HBox>
                        <Label style="-fx-text-fill: #059669; -fx-font-size: 12px; -fx-font-weight: bold;" text="Par dÃ©pense" />
                    </VBox>

                    <VBox styleClass="stat-card stat-card-purple" HBox.hgrow="ALWAYS" maxWidth="300">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label style="-fx-font-size: 32px;" text="ðŸ·" />
                            <VBox spacing="3" HBox.hgrow="ALWAYS">
                                <Label styleClass="label-section" text="CatÃ©gories" />
                                <Label fx:id="categoriesLabel" style="-fx-text-fill: #7c3aed;" styleClass="label-value" text="0" />
                            </VBox>
                        </HBox>
                        <Label style="-fx-text-fill: #a855f7; -fx-font-size: 12px; -fx-font-weight: bold;" text="UtilisÃ©es" />
                    </VBox>

                    <VBox styleClass="stat-card stat-card-amber" HBox.hgrow="ALWAYS" maxWidth="300">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <Label style="-fx-font-size: 32px;" text="âš " />
                            <VBox spacing="3" HBox.hgrow="ALWAYS">
                                <Label styleClass="label-section" text="Anomalies" />
                                <Label fx:id="anomaliesLabel" style="-fx-text-fill: #d97706;" styleClass="label-value" text="0" />
                            </VBox>
                        </HBox>
                        <Label style="-fx-text-fill: #f59e0b; -fx-font-size: 12px; -fx-font-weight: bold;" text="DÃ©tectÃ©es" />
                    </VBox>
                </HBox>

                <!-- FILTRES & ACTIONS -->
                <HBox alignment="CENTER_LEFT" spacing="14"
                      style="-fx-padding: 20 35; -fx-background-color: white;
                             -fx-border-color: #e2e8f0; -fx-border-width: 0 0 1 0;">

                    <VBox spacing="6">
                        <Label text="CatÃ©gorie" style="-fx-text-fill:#64748b; -fx-font-size:12px; -fx-font-weight:700;"/>
                        <ComboBox fx:id="filtreCategorie" prefWidth="220" styleClass="text-field" />
                    </VBox>

                    <VBox spacing="6">
                        <Label text="PÃ©riode" style="-fx-text-fill:#64748b; -fx-font-size:12px; -fx-font-weight:700;"/>
                        <ComboBox fx:id="filtrePeriode" prefWidth="220" styleClass="text-field" />
                    </VBox>

                    <VBox spacing="6">
                        <Label text="Ã‰tat financier" style="-fx-text-fill:#64748b; -fx-font-size:12px; -fx-font-weight:700;"/>
                        <ComboBox fx:id="filtreEtatFinancier" prefWidth="240" styleClass="text-field" />
                    </VBox>

                    <Region HBox.hgrow="ALWAYS" />

                    <!-- AJOUT : bouton Exporter Excel -->
                    <Button fx:id="exportExcelBtn" text="ðŸ“¥ Exporter Excel"
                            styleClass="btn-primary" minHeight="40" minWidth="170"/>

                    <Button fx:id="addBtn" minHeight="40" minWidth="170"
                            styleClass="btn-success" text="âž• Nouvelle DÃ©pense" />
                </HBox>

                <!-- Graphique circulaire -->
                <HBox alignment="CENTER" style="-fx-padding: 20 35;">
                    <PieChart fx:id="categoryPieChart" prefWidth="700" prefHeight="400"
                              title="RÃ©partition des dÃ©penses par catÃ©gorie"
                              labelsVisible="true" legendVisible="true"/>
                </HBox>

                <!-- LISTE -->
                <VBox spacing="16" style="-fx-padding: 28 35;" VBox.vgrow="ALWAYS">
                    <Label styleClass="label-subtitle" text="ðŸ“‹ Liste des DÃ©penses" />
                    <TilePane fx:id="cardsPane" hgap="16" vgap="16" prefColumns="3" style="-fx-padding: 10;" />
                    <Label fx:id="statusLabel" styleClass="label-description" text="..." />
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>